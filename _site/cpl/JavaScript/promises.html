<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/assets/css/style.css?v=5740210bc725066cedd0a42e08db8fcb909ce658">
    <link rel="stylesheet" type="text/css" href="/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

<!-- Begin Jekyll SEO tag v2.3.0 -->
<title>Asynchronous Programming and Callbacks | healym.github.io</title>
<meta property="og:title" content="Asynchronous Programming and Callbacks" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Notes and Other Interesting Thoughts" />
<meta property="og:description" content="Notes and Other Interesting Thoughts" />
<meta property="og:site_name" content="healym.github.io" />
<script type="application/ld+json">
{"name":null,"description":"Notes and Other Interesting Thoughts","author":null,"@type":"WebPage","url":"/cpl/JavaScript/promises.html","publisher":null,"image":null,"headline":"Asynchronous Programming and Callbacks","dateModified":null,"datePublished":null,"sameAs":null,"mainEntityOfPage":null,"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Asynchronous Programming and Callbacks</h1>
          <h2>Notes and Other Interesting Thoughts</h2>
        </header>
        <section id="downloads" class="clearfix">
          
	  
          <a href="http://github.com/healym/healym.github.io" id="view-on-github" class="button"><span>View on GitHub</span></a>
	  
        </section>
        <hr>
        <section id="main_content">
          <h1 id="asynchronous-programming-and-callbacks">Asynchronous Programming and Callbacks</h1>

<div class="highlighter-rouge"><pre class="highlight"><code>'use strict';
const fs = require('fs');
const log = console.log;

fs.readdir('./stuff', function(err, files) {
  if(err != null) {
    log('Uh oh!');
    return;
  }
  if(!files.includes('my_file.txt')){
    log('Uh oh!');
    return;
  }
  fs.readFile('./stuff/my_file.txt', function(err, data) {
    if(err != null) {
      log('Uh oh!');
      return;
    }
    let new-data = data + 'beep\n';
    fs.writeFile(./stuff/my_file.txt, new_data, function(err) {
      if(err != null) {
        log('Uh oh!');
      }
      fs.readFile('./stuff/my_file.txt', function(err, data) {
        log('my_file.txt now contains...');
        log(data);
      });
    });
  });
});
</code></pre>
</div>

<p>Welcome to hell.</p>

<p>This is called a callback pyramid of doom.</p>

<h2 id="promises">Promises</h2>

<p>This can be done much more simply with promises.</p>

<p>A Promise object represents the eventual completion (or failure) of an asynchronous operation, as well as it’s resulting value.</p>

<p>They also allow you to associate handlers with an asynchronous action’s eventual success or failure reason.</p>

<p>They can be in one of three states:</p>

<ol>
  <li>pending -&gt; initial state</li>
  <li>fulfilled -&gt; success state</li>
  <li>rejected -&gt; failure state</li>
</ol>

<p>Instead of registering callbacks, we tell a Promise what to do if a computation suceeds or fails using the following methods:</p>

<p><code class="highlighter-rouge">.then(/* success handler */)</code></p>

<p><code class="highlighter-rouge">.catch(/ *failure handler */)</code></p>

<h3 id="facts-about-promises">Facts about Promises</h3>

<ul>
  <li>
    <p>Modern JS libraries use Promises a lot.</p>
  </li>
  <li>
    <p>Not all libraries are written to use Promises.</p>
  </li>
  <li>
    <p>Node v6.11 has Promise.</p>
  </li>
  <li>
    <p>Node v8.x has Promise and <code class="highlighter-rouge">utils.promisify()</code>.</p>
  </li>
</ul>

<h3 id="examples">Examples</h3>
<div class="highlighter-rouge"><pre class="highlight"><code>'use struct';
const fs = require('fs')
const log = console.log

readdirP('./stuff')
  .then(function(files) {
    if(!files.includes('my_file.txt')) {
      raise "Oh no!";
    }
    return readFileP('./stuff/my_file.txt');
  }).then(function(data) {
    let new_data = data + 'beep\n';
    return writeFile('.stuff/my_file.txt', new_data);
    }).then(function() {
      return readFileP('./stuff/my_file.txt')
      }).then(function(data) {
        log('my_file.txt now contains...');
        log(data);
        }).catch(function(err) {
          log("Uh oh!");
          });
</code></pre>
</div>

<p>See how painless that was?</p>

<h3 id="creating-promise-out-of-a-node-style-callback-function">Creating Promise out of a Node-Style-callback function</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>const readFileP = function(path) {
  return new Promise(function(resolve, reject) {
    fs.readFile(path, function(err, data){
      if(err != null) {
        reject(err);
      } else {
        resolve(data);
      }
    });
  });
};
</code></pre>
</div>

        </section>

        <footer>
        
          healym.github.io is maintained by <a href="http://github.com/healym">healym</a><br>
        
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

      </div>
    </div>

    
  </body>
</html>
